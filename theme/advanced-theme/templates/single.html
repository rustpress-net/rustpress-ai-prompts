{% extends "base.html" %}

{% block title %}{{ post.title }} - {{ site.name }}{% endblock %}

{% block body_class %}single single-post{% endblock %}

{% block content %}
<article class="post post-single" id="post-{{ post.id }}">
    {# Post Header #}
    <header class="post-header">
        <div class="container container-narrow">
            {# Categories #}
            {% if post.categories %}
            <div class="post-categories">
                {% for category in post.categories %}
                <a href="{{ category.url }}" class="category-link">{{ category.name }}</a>
                {% endfor %}
            </div>
            {% endif %}

            <h1 class="post-title">{{ post.title }}</h1>

            {# Post Meta #}
            <div class="post-meta">
                <div class="post-author">
                    {% if post.author.avatar %}
                    <img src="{{ post.author.avatar | image_url(size='avatar') }}"
                         alt="{{ post.author.name }}"
                         class="author-avatar">
                    {% endif %}
                    <div class="author-info">
                        <span class="author-name">{{ post.author.name }}</span>
                        <time class="post-date" datetime="{{ post.published_at | date(format='%Y-%m-%d') }}">
                            {{ post.published_at | date(format='%B %d, %Y') }}
                        </time>
                    </div>
                </div>

                <div class="post-stats">
                    <span class="reading-time">{{ post.content | reading_time }} min read</span>
                    {% if post.comment_count > 0 %}
                    <span class="comment-count">{{ post.comment_count }} comments</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </header>

    {# Featured Image #}
    {% if post.featured_image %}
    <div class="post-featured-image">
        <div class="container">
            <figure>
                <img src="{{ post.featured_image | image_url(size='hero') }}"
                     alt="{{ post.title }}"
                     class="featured-image">
                {% if post.featured_image_caption %}
                <figcaption>{{ post.featured_image_caption }}</figcaption>
                {% endif %}
            </figure>
        </div>
    </div>
    {% endif %}

    {# Post Content #}
    <div class="post-content-wrapper">
        <div class="container container-narrow">
            <div class="content-area {% if theme.sidebar_position != 'none' %}has-sidebar{% endif %}">
                <div class="main-content">
                    {# Table of Contents (if enabled) #}
                    {% if theme.show_toc and post.toc %}
                    <nav class="table-of-contents" aria-label="Table of contents">
                        <h3>Table of Contents</h3>
                        {{ post.toc | safe }}
                    </nav>
                    {% endif %}

                    {# Post Content #}
                    <div class="post-content entry-content">
                        {{ post.content | safe }}
                    </div>

                    {# Tags #}
                    {% if post.tags %}
                    <footer class="post-footer">
                        <div class="post-tags">
                            <span class="tags-label">Tags:</span>
                            {% for tag in post.tags %}
                            <a href="{{ tag.url }}" class="tag-link">#{{ tag.name }}</a>
                            {% endfor %}
                        </div>

                        {# Share Buttons #}
                        {% include "partials/share-buttons.html" %}
                    </footer>
                    {% endif %}

                    {# Author Bio #}
                    {% if post.author.bio %}
                    <div class="author-bio">
                        {% if post.author.avatar %}
                        <img src="{{ post.author.avatar | image_url(size='avatar') }}"
                             alt="{{ post.author.name }}"
                             class="author-avatar-large">
                        {% endif %}
                        <div class="author-details">
                            <h3 class="author-name">{{ post.author.name }}</h3>
                            <p class="author-description">{{ post.author.bio }}</p>
                            {% if post.author.website %}
                            <a href="{{ post.author.website }}" class="author-link">Visit website</a>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                    {# Post Navigation #}
                    <nav class="post-navigation" aria-label="Post navigation">
                        {% if prev_post %}
                        <a href="{{ prev_post.url }}" class="nav-previous">
                            <span class="nav-label">Previous</span>
                            <span class="nav-title">{{ prev_post.title }}</span>
                        </a>
                        {% endif %}
                        {% if next_post %}
                        <a href="{{ next_post.url }}" class="nav-next">
                            <span class="nav-label">Next</span>
                            <span class="nav-title">{{ next_post.title }}</span>
                        </a>
                        {% endif %}
                    </nav>

                    {# Related Posts #}
                    {% if related_posts %}
                    <section class="related-posts">
                        <h3>Related Posts</h3>
                        <div class="related-posts-grid">
                            {% for related in related_posts %}
                            <article class="related-post">
                                {% if related.featured_image %}
                                <a href="{{ related.url }}" class="related-thumbnail">
                                    <img src="{{ related.featured_image | image_url(size='card') }}"
                                         alt="{{ related.title }}"
                                         loading="lazy">
                                </a>
                                {% endif %}
                                <h4><a href="{{ related.url }}">{{ related.title }}</a></h4>
                            </article>
                            {% endfor %}
                        </div>
                    </section>
                    {% endif %}

                    {# Comments #}
                    {% if post.comments_enabled %}
                    <section class="comments-section" id="comments">
                        <h3>Comments ({{ post.comment_count }})</h3>
                        {% include "partials/comments.html" %}
                    </section>
                    {% endif %}
                </div>

                {# Sidebar #}
                {% if theme.sidebar_position != 'none' %}
                <aside class="sidebar sidebar-{{ theme.sidebar_position }}">
                    {{ widgets("sidebar") }}
                </aside>
                {% endif %}
            </div>
        </div>
    </div>
</article>
{% endblock %}
